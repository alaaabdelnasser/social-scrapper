name: Deploy To Bluehost

on:
  push:
    branches: [ "master" ]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy Backend
        uses: appleboy/ssh-action@v0.1.4
        with:
          host: ${{secrets.SSH_HOST}}
          username: ${{ secrets.SSH_USER }}
          password: ${{secrets.SSH_PASSWORD}}
          script: |
            cd /home2/wxqbnfmy/forms.codepresso.net
            git reset --hard
            git switch master
            git pull origin master
            yes | composer install --optimize-autoloader --no-dev --prefer-dist
            php artisan migrate:fresh --seed --force
            php artisan optimize:clear
